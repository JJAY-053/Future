<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Comparison & Analysis Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f3ef 0%, #ebe8e0 100%);
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #fafaf8;
            border-radius: 8px;
            border: 1px solid #e8e6df;
        }

        .section-title {
            font-size: 1.3em;
            color: #34495e;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .helper-text {
            color: #95a5a6;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .upload-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .upload-box {
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: #fff;
            transition: all 0.3s;
        }

        .upload-box:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .upload-box.has-file {
            border-color: #27ae60;
            background: #f0fdf4;
        }

        input[type="file"] {
            display: none;
        }

        .file-label {
            cursor: pointer;
            display: inline-block;
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border-radius: 6px;
            font-weight: 500;
            transition: background 0.3s;
        }

        .file-label:hover {
            background: #2980b9;
        }

        .file-name {
            margin-top: 10px;
            color: #27ae60;
            font-weight: 500;
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .search-input:focus {
            outline: none;
            border-color: #3498db;
        }

        button {
            padding: 12px 24px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 1em;
        }

        button:hover {
            background: #27ae60;
        }

        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .download-btn {
            background: #e67e22;
            padding: 8px 16px;
            font-size: 0.9em;
            margin-right: 10px;
            margin-top: 10px;
        }

        .download-btn:hover {
            background: #d35400;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e8e6df;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .table-container {
            overflow: auto;
            margin-top: 15px;
            border-radius: 8px;
            border: 1px solid #e8e6df;
            max-height: 400px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 0.9em;
        }

        th {
            background: #34495e;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid #ecf0f1;
        }

        tr:hover {
            background: #f8f9fa;
        }

        tr.highlight {
            background: #fff3cd !important;
            border-left: 4px solid #ffc107;
        }

        .highlight-text {
            background: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e8e6df;
        }

        .keyword-stats {
            margin-top: 20px;
        }

        .keyword-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid #e8e6df;
        }

        .keyword-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .keyword-counts {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #95a5a6;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .upload-area {
                grid-template-columns: 1fr;
            }

            .search-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSV Comparison & Analysis Tool</h1>
        <p class="subtitle">Upload two CSV files, search for keywords, and analyse matches with detailed statistics and visualisations</p>

        <!-- Upload Section -->
        <div class="section">
            <h2 class="section-title">1. Upload CSV Files</h2>
            <p class="helper-text">Upload two CSV files to begin. Files are processed entirely in your browser - no data is sent to any server.</p>
            <div class="upload-area">
                <div class="upload-box" id="uploadBox1">
                    <input type="file" id="file1" accept=".csv" onchange="handleFile(1, this.files[0])">
                    <label for="file1" class="file-label">Choose CSV File 1</label>
                    <div class="file-name" id="fileName1"></div>
                </div>
                <div class="upload-box" id="uploadBox2">
                    <input type="file" id="file2" accept=".csv" onchange="handleFile(2, this.files[0])">
                    <label for="file2" class="file-label">Choose CSV File 2</label>
                    <div class="file-name" id="fileName2"></div>
                </div>
            </div>
        </div>

        <!-- CSV Display -->
        <div id="csvDisplay" style="display: none;">
            <div class="section">
                <h2 class="section-title">CSV File 1: <span id="csv1Name"></span></h2>
                <div class="table-container" id="table1Container"></div>
            </div>

            <div class="section">
                <h2 class="section-title">CSV File 2: <span id="csv2Name"></span></h2>
                <div class="table-container" id="table2Container"></div>
            </div>
        </div>

        <!-- Search Section -->
        <div class="section" id="searchSection" style="display: none;">
            <h2 class="section-title">2. Search Keywords/Phrases</h2>
            <p class="helper-text">Enter up to 10 keywords or phrases to search across all columns in both CSV files.</p>
            
            <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 6px; border: 1px solid #e8e6df;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="caseSensitive" style="width: 18px; height: 18px; margin-right: 10px; cursor: pointer;">
                    <span style="font-weight: 500; color: #34495e;">
                        Case-sensitive / Exact matching
                    </span>
                </label>
                <p style="margin: 5px 0 0 28px; font-size: 0.85em; color: #7f8c8d;">
                    When checked, searches will match exact case (e.g., "Apple" â‰  "apple"). When unchecked, searches are case-insensitive.
                </p>
            </div>

            <div style="margin-bottom: 20px;">
                <h3 style="color: #34495e; font-size: 1.1em; margin-bottom: 10px;">Quick Entry (Bulk Input)</h3>
                <p style="font-size: 0.85em; color: #7f8c8d; margin-bottom: 10px;">
                    Enter multiple keywords at once, separated by commas or slashes (e.g., apple, banana, cherry or apple/banana/cherry)
                </p>
                <textarea 
                    id="bulkSearch" 
                    placeholder="Enter keywords separated by commas or slashes (e.g., apple, banana, cherry)"
                    style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95em; font-family: inherit; resize: vertical; min-height: 80px;"
                    oninput="updateIndividualInputs()"
                ></textarea>
                <button onclick="clearAllSearches()" style="background: #95a5a6; margin-top: 10px; padding: 8px 16px; font-size: 0.9em;">Clear All</button>
            </div>

            <div style="margin-bottom: 20px;">
                <h3 style="color: #34495e; font-size: 1.1em; margin-bottom: 10px;">Individual Entries (Optional)</h3>
                <p style="font-size: 0.85em; color: #7f8c8d; margin-bottom: 10px;">
                    Or enter keywords one by one in the boxes below
                </p>
                <div class="search-grid" id="searchGrid"></div>
            </div>

            <button onclick="performSearch()">Search & Analyse</button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" style="display: none;">
            <!-- Statistics -->
            <div class="section">
                <h2 class="section-title">3. Search Statistics</h2>
                <div class="stats-grid" id="statsGrid"></div>
                <div class="keyword-stats" id="keywordStats"></div>
            </div>

            <!-- Visualisations -->
            <div class="section">
                <h2 class="section-title">4. Visualisations</h2>
                <p class="helper-text">Visual representation of keyword matches across both CSV files</p>
                <div class="chart-container">
                    <canvas id="matchChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>

            <!-- Filtered Results -->
            <div class="section">
                <h2 class="section-title">5. Filtered Results</h2>
                <p class="helper-text">Rows containing at least one keyword match are highlighted. Download matched rows only.</p>
                
                <h3 style="margin-top: 20px; color: #34495e;">CSV File 1 - Matched Rows</h3>
                <button class="download-btn" onclick="downloadMatched(1)">Download Matched Rows (CSV 1)</button>
                <div class="table-container" id="filtered1Container"></div>

                <h3 style="margin-top: 30px; color: #34495e;">CSV File 2 - Matched Rows</h3>
                <button class="download-btn" onclick="downloadMatched(2)">Download Matched Rows (CSV 2)</button>
                <div class="table-container" id="filtered2Container"></div>
            </div>
        </div>
    </div>

    <script>
        let csvData1 = null;
        let csvData2 = null;
        let matchedRows1 = [];
        let matchedRows2 = [];
        let searchResults = {};

        // Initialize search inputs
        function initSearchInputs() {
            const grid = document.getElementById('searchGrid');
            grid.innerHTML = '';
            for (let i = 1; i <= 10; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'search-input';
                input.id = `search${i}`;
                input.placeholder = `Keyword/Phrase ${i}`;
                input.addEventListener('input', updateBulkInput);
                grid.appendChild(input);
            }
        }

        // Update individual inputs from bulk input
        function updateIndividualInputs() {
            const bulkText = document.getElementById('bulkSearch').value;
            // Split by comma or slash, trim whitespace, and filter empty strings
            const keywords = bulkText
                .split(/[,\/]/)
                .map(kw => kw.trim())
                .filter(kw => kw.length > 0)
                .slice(0, 10); // Limit to 10 keywords

            // Populate individual inputs
            for (let i = 1; i <= 10; i++) {
                const input = document.getElementById(`search${i}`);
                if (input) {
                    // Temporarily remove event listener to avoid circular updates
                    input.removeEventListener('input', updateBulkInput);
                    input.value = keywords[i - 1] || '';
                    input.addEventListener('input', updateBulkInput);
                }
            }
        }

        // Update bulk input from individual inputs
        function updateBulkInput() {
            const keywords = [];
            for (let i = 1; i <= 10; i++) {
                const val = document.getElementById(`search${i}`).value.trim();
                if (val) keywords.push(val);
            }
            
            const bulkInput = document.getElementById('bulkSearch');
            // Temporarily remove event listener to avoid circular updates
            bulkInput.removeEventListener('input', updateIndividualInputs);
            bulkInput.value = keywords.join(', ');
            bulkInput.addEventListener('input', updateIndividualInputs);
        }

        // Clear all searches
        function clearAllSearches() {
            document.getElementById('bulkSearch').value = '';
            for (let i = 1; i <= 10; i++) {
                document.getElementById(`search${i}`).value = '';
            }
        }

        // Handle file upload
        function handleFile(fileNum, file) {
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                Papa.parse(e.target.result, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true,
                    complete: function(results) {
                        if (fileNum === 1) {
                            csvData1 = results.data;
                            document.getElementById('fileName1').textContent = file.name;
                            document.getElementById('uploadBox1').classList.add('has-file');
                            document.getElementById('csv1Name').textContent = file.name;
                            displayTable(1, csvData1);
                        } else {
                            csvData2 = results.data;
                            document.getElementById('fileName2').textContent = file.name;
                            document.getElementById('uploadBox2').classList.add('has-file');
                            document.getElementById('csv2Name').textContent = file.name;
                            displayTable(2, csvData2);
                        }

                        if (csvData1 && csvData2) {
                            document.getElementById('csvDisplay').style.display = 'block';
                            document.getElementById('searchSection').style.display = 'block';
                            initSearchInputs();
                        }
                    }
                });
            };
            reader.readAsText(file);
        }

        // Display CSV table
        function displayTable(fileNum, data, containerId = null, highlightIndices = null) {
            if (!data || data.length === 0) return;

            const container = document.getElementById(containerId || `table${fileNum}Container`);
            const headers = Object.keys(data[0]);

            let html = '<table><thead><tr>';
            headers.forEach(h => {
                html += `<th>${h}</th>`;
            });
            html += '</tr></thead><tbody>';

            data.forEach((row, idx) => {
                const isHighlighted = highlightIndices && highlightIndices.includes(idx);
                html += `<tr class="${isHighlighted ? 'highlight' : ''}">`;
                headers.forEach(h => {
                    let cellValue = row[h] !== null && row[h] !== undefined ? String(row[h]) : '';
                    
                    if (isHighlighted) {
                        const keywords = getSearchKeywords();
                        const caseSensitive = searchResults.caseSensitive || false;
                        keywords.forEach(kw => {
                            if (kw) {
                                const flags = caseSensitive ? 'g' : 'gi';
                                const regex = new RegExp(`(${escapeRegex(kw)})`, flags);
                                cellValue = cellValue.replace(regex, '<span class="highlight-text">$1</span>');
                            }
                        });
                    }
                    
                    html += `<td>${cellValue}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Get search keywords
        function getSearchKeywords() {
            const keywords = [];
            for (let i = 1; i <= 10; i++) {
                const val = document.getElementById(`search${i}`).value.trim();
                if (val) keywords.push(val);
            }
            return keywords;
        }

        // Escape regex special characters
        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Perform search
        function performSearch() {
            const keywords = getSearchKeywords();
            if (keywords.length === 0) {
                alert('Please enter at least one keyword to search');
                return;
            }

            const caseSensitive = document.getElementById('caseSensitive').checked;

            searchResults = {
                keywords: keywords,
                caseSensitive: caseSensitive,
                csv1: { total: 0, byKeyword: {}, byColumn: {}, matchedIndices: [] },
                csv2: { total: 0, byKeyword: {}, byColumn: {}, matchedIndices: [] }
            };

            // Initialize counters
            keywords.forEach(kw => {
                searchResults.csv1.byKeyword[kw] = 0;
                searchResults.csv2.byKeyword[kw] = 0;
            });

            // Search CSV 1
            matchedRows1 = [];
            csvData1.forEach((row, idx) => {
                let rowMatched = false;
                Object.keys(row).forEach(col => {
                    const cellValue = String(row[col] || '');
                    keywords.forEach(kw => {
                        const match = caseSensitive 
                            ? cellValue.includes(kw)
                            : cellValue.toLowerCase().includes(kw.toLowerCase());
                        
                        if (match) {
                            rowMatched = true;
                            searchResults.csv1.byKeyword[kw]++;
                            searchResults.csv1.byColumn[col] = (searchResults.csv1.byColumn[col] || 0) + 1;
                        }
                    });
                });
                if (rowMatched) {
                    searchResults.csv1.matchedIndices.push(idx);
                    matchedRows1.push(row);
                }
            });
            searchResults.csv1.total = matchedRows1.length;

            // Search CSV 2
            matchedRows2 = [];
            csvData2.forEach((row, idx) => {
                let rowMatched = false;
                Object.keys(row).forEach(col => {
                    const cellValue = String(row[col] || '');
                    keywords.forEach(kw => {
                        const match = caseSensitive 
                            ? cellValue.includes(kw)
                            : cellValue.toLowerCase().includes(kw.toLowerCase());
                        
                        if (match) {
                            rowMatched = true;
                            searchResults.csv2.byKeyword[kw]++;
                            searchResults.csv2.byColumn[col] = (searchResults.csv2.byColumn[col] || 0) + 1;
                        }
                    });
                });
                if (rowMatched) {
                    searchResults.csv2.matchedIndices.push(idx);
                    matchedRows2.push(row);
                }
            });
            searchResults.csv2.total = matchedRows2.length;

            displayResults();
        }

        // Display results
        function displayResults() {
            document.getElementById('resultsSection').style.display = 'block';

            // Display statistics
            displayStats();

            // Display visualisations
            displayCharts();

            // Display filtered tables
            displayTable(1, matchedRows1, 'filtered1Container', null);
            displayTable(2, matchedRows2, 'filtered2Container', null);

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Display statistics
        function displayStats() {
            const statsGrid = document.getElementById('statsGrid');
            const totalMatches = searchResults.csv1.total + searchResults.csv2.total;
            const totalKeywordMatches = Object.values(searchResults.csv1.byKeyword).reduce((a, b) => a + b, 0) +
                                       Object.values(searchResults.csv2.byKeyword).reduce((a, b) => a + b, 0);

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${searchResults.keywords.length}</div>
                    <div class="stat-label">Keywords Searched</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalMatches}</div>
                    <div class="stat-label">Total Matched Rows</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${searchResults.csv1.total}</div>
                    <div class="stat-label">CSV 1 Matches</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${searchResults.csv2.total}</div>
                    <div class="stat-label">CSV 2 Matches</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalKeywordMatches}</div>
                    <div class="stat-label">Total Keyword Hits</div>
                </div>
            `;

            // Keyword breakdown
            const keywordStats = document.getElementById('keywordStats');
            let keywordHtml = '<h3 style="margin-bottom: 15px; color: #34495e;">Keyword Match Breakdown</h3>';
            searchResults.keywords.forEach(kw => {
                const csv1Count = searchResults.csv1.byKeyword[kw] || 0;
                const csv2Count = searchResults.csv2.byKeyword[kw] || 0;
                keywordHtml += `
                    <div class="keyword-item">
                        <div class="keyword-name">"${kw}"</div>
                        <div class="keyword-counts">
                            <span>CSV 1: ${csv1Count} matches</span>
                            <span>CSV 2: ${csv2Count} matches</span>
                            <span>Total: ${csv1Count + csv2Count} matches</span>
                        </div>
                    </div>
                `;
            });
            keywordStats.innerHTML = keywordHtml;
        }

        // Display charts
        function displayCharts() {
            // Destroy existing charts
            const ctx1 = document.getElementById('matchChart');
            const ctx2 = document.getElementById('distributionChart');
            
            if (ctx1 && window.matchChart instanceof Chart) {
                window.matchChart.destroy();
            }
            if (ctx2 && window.distributionChart instanceof Chart) {
                window.distributionChart.destroy();
            }

            // Keyword comparison chart
            const labels = searchResults.keywords;
            const csv1Data = labels.map(kw => searchResults.csv1.byKeyword[kw] || 0);
            const csv2Data = labels.map(kw => searchResults.csv2.byKeyword[kw] || 0);

            window.matchChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'CSV File 1',
                        data: csv1Data,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }, {
                        label: 'CSV File 2',
                        data: csv2Data,
                        backgroundColor: 'rgba(46, 204, 113, 0.7)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Keyword Match Frequency Comparison',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' matches';
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                precision: 0,
                                stepSize: 1
                            }
                        }
                    }
                }
            });

            // Column distribution chart
            const allColumns = new Set([
                ...Object.keys(searchResults.csv1.byColumn),
                ...Object.keys(searchResults.csv2.byColumn)
            ]);
            const columnLabels = Array.from(allColumns);
            const columnCsv1Data = columnLabels.map(col => searchResults.csv1.byColumn[col] || 0);
            const columnCsv2Data = columnLabels.map(col => searchResults.csv2.byColumn[col] || 0);

            window.distributionChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: columnLabels,
                    datasets: [{
                        label: 'CSV File 1',
                        data: columnCsv1Data,
                        backgroundColor: 'rgba(155, 89, 182, 0.7)',
                        borderColor: 'rgba(155, 89, 182, 1)',
                        borderWidth: 1
                    }, {
                        label: 'CSV File 2',
                        data: columnCsv2Data,
                        backgroundColor: 'rgba(230, 126, 34, 0.7)',
                        borderColor: 'rgba(230, 126, 34, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Match Distribution by Column',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' matches in "' + context.label + '"';
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                precision: 0,
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Download matched rows
        function downloadMatched(fileNum) {
            const data = fileNum === 1 ? matchedRows1 : matchedRows2;
            if (data.length === 0) {
                alert('No matched rows to download');
                return;
            }

            const csv = Papa.unparse(data);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `matched_rows_csv${fileNum}_${new Date().getTime()}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>